# Browser Extension Plan â€” AI Accessibility Assistant

## What It Does

A Chrome/Edge extension that works on **any webpage**. The user highlights text (or right-clicks), and the extension can:

- ğŸ“– **Read it aloud** (TTS via backend)
- ğŸ§  **Summarize it** (Summarizer via backend)
- ğŸ™ï¸ **Ask the AI Tutor** a voice question about the content
- ğŸ“¸ **Capture a screenshot** of any page (OCR via backend)

---

## How a Browser Extension Works

A browser extension has 3 main pieces:

```
extension/
â”œâ”€â”€ manifest.json        â† tells Chrome what the extension does & needs
â”œâ”€â”€ popup/
â”‚   â”œâ”€â”€ popup.html       â† the small UI that opens when you click the icon
â”‚   â”œâ”€â”€ popup.js         â† logic for the popup
â”‚   â””â”€â”€ popup.css        â† styles
â”œâ”€â”€ content/
â”‚   â””â”€â”€ content.js       â† injected into every webpage (reads page text, highlights)
â”œâ”€â”€ background/
â”‚   â””â”€â”€ background.js    â† service worker (handles API calls, coordinates messages)
â””â”€â”€ icons/
    â””â”€â”€ icon128.png
```

### The 3 Pieces Explained

| Piece | What it is | What it does in our app |
|-------|-----------|------------------------|
| **Popup** | The small window when you click the extension icon | Shows controls: Read Aloud, Summarize, Ask Tutor |
| **Content Script** | JS injected into every tab | Grabs selected/page text, highlights sentences during TTS |
| **Background Worker** | A persistent service worker | Makes all the `fetch()` calls to `localhost:3001/api` |

> [!IMPORTANT]
> Content scripts **cannot** directly call your backend (CORS). They pass messages to the **background worker**, which makes the actual API calls. This is the core architecture pattern.

---

## Message Flow

```mermaid
sequenceDiagram
    participant User
    participant Popup
    participant ContentScript
    participant Background
    participant Backend

    User->>Popup: Clicks "Summarize"
    Popup->>Background: chrome.runtime.sendMessage({ action: "summarize" })
    Background->>ContentScript: chrome.tabs.sendMessage({ action: "getSelection" })
    ContentScript-->>Background: { text: "selected text..." }
    Background->>Backend: POST localhost:3001/api/summarize
    Backend-->>Background: { takeaways: [...] }
    Background-->>Popup: { success, takeaways }
    Popup->>User: Shows summary UI
```

---

## File Structure (in this repo)

```
Hacked 2026/
â”œâ”€â”€ backend/             â† existing Node.js API (unchanged)
â”œâ”€â”€ frontend/            â† existing React app (unchanged)
â””â”€â”€ extension/           â† NEW folder on agal-extension branch
    â”œâ”€â”€ manifest.json
    â”œâ”€â”€ popup/
    â”‚   â”œâ”€â”€ popup.html
    â”‚   â”œâ”€â”€ popup.js
    â”‚   â””â”€â”€ popup.css
    â”œâ”€â”€ content/
    â”‚   â””â”€â”€ content.js
    â”œâ”€â”€ background/
    â”‚   â””â”€â”€ background.js
    â””â”€â”€ icons/
        â””â”€â”€ icon128.png
```

> [!NOTE]
> The extension talks to the **same backend** (`localhost:3001/api`) as the React frontend. Zero backend changes needed.

---

## Backend Endpoints Used

| Feature | Endpoint | Notes |
|---------|----------|-------|
| Read Aloud | `POST /api/tts/synthesize` | Returns mp3 audio |
| Summarize | `POST /api/summarize` | Returns takeaways[] |
| Ask Tutor | `POST /api/tutor/ask` | Returns answer text |
| Voice Question | `POST /api/tutor/transcribe` | Sends mic audio â†’ text |
| Screenshot OCR | `POST /api/ocr` | Sends base64 screenshot |

---

## The Popup UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§  AI Accessibility Assistant  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Selected: "Newton's first lawâ€¦"â”‚
â”‚  (24 words)                     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  [ â–¶ Read Aloud ]               â”‚
â”‚  [ ğŸ§  Summarize ]               â”‚
â”‚  [ ğŸ™ï¸ Ask Tutor ]               â”‚
â”‚  [ ğŸ“¸ Capture Screen ]          â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â— Backend: Connected âœ“         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## CORS â€” The Key Problem to Solve

The backend needs to allow requests from the extension's origin. Add this to the Express server:

```js
// backend/src/index.js â€” add to existing CORS config
app.use(cors({
  origin: [
    "http://localhost:5173",          // React frontend
    /chrome-extension:\/\/.*/         // â† add this for the extension
  ]
}));
```

---

## Build Phases

### Phase 1 â€” Skeleton (can test immediately)
- `manifest.json` with correct permissions
- `popup.html` with buttons (no logic yet)
- `background.js` with backend health check
- Load into Chrome â†’ verify icon appears

### Phase 2 â€” Core Features
- Get selected text from page via content script
- Hook up Summarize button â†’ shows takeaways in popup
- Hook up Read Aloud â†’ plays TTS audio in tab

### Phase 3 â€” Voice & Screenshot
- Mic recording in popup â†’ Tutor transcription
- Screenshot via `chrome.tabs.captureVisibleTab()` â†’ OCR

---

## How to Load It in Chrome (Dev Mode)

1. Go to `chrome://extensions`
2. Enable **Developer Mode** (top right toggle)
3. Click **Load unpacked**
4. Select the `extension/` folder
5. Pin it to the toolbar

> [!WARNING]
> The extension only works while the backend is running (`npm run dev` in `/backend`). If the backend is off, API calls will fail gracefully with an error message in the popup.

---

## Permissions Needed (manifest.json)

```json
"permissions": [
  "activeTab",       â† read current tab's text
  "scripting",       â† inject content.js
  "storage",         â† save settings
  "tabs",            â† capture screenshots
  "microphone"       â† record voice questions
]
```
